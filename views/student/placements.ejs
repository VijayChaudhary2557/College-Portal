<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<div class="min-h-screen gradient-bg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="mb-8 flex items-center justify-between">
            <h1 class="text-2xl sm:text-3xl font-bold text-white flex items-center gap-3">
                <span class="w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center"><i class="bi bi-briefcase"></i></span>
                Placement Opportunities
            </h1>
        </div>

        <% if (placements && placements.length > 0) { %>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <% placements.forEach(placement => { %>
                    <div class="rounded-2xl bg-white/95 backdrop-blur shadow-soft border border-slate-200/80 overflow-hidden card-hover">
                        <div class="px-6 py-4 bg-gradient-to-r from-primary-500 to-primary-700 text-white">
                            <h3 class="font-bold flex items-center gap-2"><i class="bi bi-building"></i> <%= placement.companyName %></h3>
                        </div>
                        <div class="p-6">
                            <h4 class="font-semibold text-slate-800 mb-2"><%= placement.jobTitle %></h4>
                            <p class="text-slate-600 text-sm mb-4"><%= placement.description || 'No description available' %></p>
                            <ul class="space-y-2 text-sm text-slate-600 mb-4">
                                <li class="flex items-center gap-2"><i class="bi bi-geo-alt text-primary-500 w-5"></i> <%= placement.location %></li>
                                <li class="flex items-center gap-2"><i class="bi bi-currency-dollar text-primary-500 w-5"></i> <%= placement.ctc %></li>
                                <li class="flex items-center gap-2"><i class="bi bi-calendar-event text-primary-500 w-5"></i> Drive: <%= new Date(placement.driveDate).toLocaleDateString() %></li>
                                <li class="flex items-center gap-2"><i class="bi bi-clock text-primary-500 w-5"></i> Apply by: <%= new Date(placement.lastDateToApply).toLocaleDateString() %></li>
                            </ul>

                            <% if (placement.userApplication) { %>
                                <div class="p-3 rounded-xl bg-emerald-50 border border-emerald-200 mb-3">
                                    <span class="text-sm font-medium text-emerald-800">Status: </span>
                                    <span class="inline-flex px-2.5 py-1 rounded-lg bg-emerald-100 text-emerald-700 text-sm font-medium"><%= placement.userApplication.status %></span>
                                </div>
                                <% if (placement.userApplication.status === 'interested') { %>
                                    <div class="h-2 rounded-full bg-slate-200 overflow-hidden"><div class="h-full w-1/5 rounded-full bg-sky-500"></div></div>
                                    <p class="text-xs text-slate-500 mt-1">Interested</p>
                                <% } else if (placement.userApplication.status === 'written-test') { %>
                                    <div class="h-2 rounded-full bg-slate-200 overflow-hidden"><div class="h-full w-2/5 rounded-full bg-primary-500"></div></div>
                                    <p class="text-xs text-slate-500 mt-1">Written Test</p>
                                <% } else if (placement.userApplication.status === 'technical-interview') { %>
                                    <div class="h-2 rounded-full bg-slate-200 overflow-hidden"><div class="h-full w-3/5 rounded-full bg-amber-500"></div></div>
                                    <p class="text-xs text-slate-500 mt-1">Technical Interview</p>
                                <% } else if (placement.userApplication.status === 'coding-round') { %>
                                    <div class="h-2 rounded-full bg-slate-200 overflow-hidden"><div class="h-full w-4/5 rounded-full bg-sky-500"></div></div>
                                    <p class="text-xs text-slate-500 mt-1">Coding Round</p>
                                <% } else if (placement.userApplication.status === 'final-round') { %>
                                    <div class="h-2 rounded-full bg-slate-200 overflow-hidden"><div class="h-full w-full rounded-full bg-emerald-500"></div></div>
                                    <p class="text-xs text-slate-500 mt-1">Final Round</p>
                                <% } %>
                            <% } else { %>
                                <% const canApply = new Date() <= new Date(placement.lastDateToApply); %>
                                <% if (canApply) { %>
                                    <form action="/student/placements/<%= placement._id %>/apply" method="POST">
                                        <button type="submit" class="w-full py-3 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white font-semibold flex items-center justify-center gap-2">
                                            <i class="bi bi-check-circle"></i> Apply for Placement
                                        </button>
                                    </form>
                                <% } else { %>
                                    <button disabled class="w-full py-3 rounded-xl bg-slate-300 text-slate-500 font-medium cursor-not-allowed flex items-center justify-center gap-2">
                                        <i class="bi bi-x-circle"></i> Application Closed
                                    </button>
                                <% } %>
                            <% } %>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <div class="rounded-2xl bg-white/95 backdrop-blur shadow-soft border border-slate-200/80 p-12 text-center">
                <span class="inline-flex w-16 h-16 rounded-2xl bg-slate-100 text-slate-400 items-center justify-center mb-4"><i class="bi bi-inbox text-3xl"></i></span>
                <p class="text-slate-500 text-lg">No placement opportunities available at the moment</p>
            </div>
        <% } %>
    </div>
</div>

<%- include('../partials/footer') %>
